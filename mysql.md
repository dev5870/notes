### MySQL

---

#### Основные команды

| Команда | Описание |
| ------------- | ------------- |
| mysql -u root -p  | Авторизация под пользователем root  |
| mysql.server start | Start mysql на macos  |
| sudo service mysql start/restart/stop | Старт, рестарт, стоп mysql в Ubuntu |
| mysqldump -uroot -p db_name > file_name.sql | Бэкап базы данных |
| mysql db_name -u user_name -p < dump.sql | Залить базу на сервер mysql |
| show databases | Показать список всех баз данных |
| use db_name | Переход в определенную базу данных |
| show tables | Показать все таблицы в базе данных |
| show columns from table_name | Показать все столбцы в таблице |
| select count(*) from table_name | Считаем количество записей в таблице |

#### CREATE

| Команда | Описание |
| ------------- | ------------- |
| create database db_name | Создание базы данных |
| create user 'userName'@'localhost' identified by 'password' | Создание пользователя БД |

#### DROP

| Команда | Описание |
| ------------- | ------------- |
| drop user 'userName'@'localhost' | Удаление пользователя БД |

#### SELECT

| Команда | Описание |
| ------------- | ------------- |
| select * from users | Показать все записи из таблицы users |
| select * from users where balance = 10 | Показать все записи из таблицы users, где balance = 10 |
| select * from users where balance = 10 and mfa = 0 | Показать все записи из таблицы users, где balance = 10 и mfa = 0 |

#### GRANT

| Команда | Описание |
| ------- | -------- |
| GRANT ALL PRIVILEGES ON db_name.* TO user@localhost with grant option; | Даем привилегии на базу данных определенному пользователю |

##### Примеры

1. Задача:

  *Показать все значения из столбцов id, balance, в таблице users, где balance = 10*

  Запрос:

  `select id, balance from users where balance = 10`

  Результат:
        +--------+---------+
        | id     | balance |
        +--------+---------+
        | 422    | 10.00   |
        | 832    | 10.00   |
        | 2966   | 10.00   |
        | 4534   | 10.00   |
        | 7391   | 10.00   |
        | 10079  | 10.00   |
        | 10535  | 10.00   |
        | 11575  | 10.00   |
        | 12077  | 10.00   |
        | 12173  | 10.00   |
        | 15459  | 10.00   |
        | 15739  | 10.00   |
        | 17237  | 10.00   |
        | 157937 | 10.00   |
        +--------+---------+

2. Задача:

  *Показать все значения из столбцов id, balance, в таблице users, где email содержит слово test и balance > 1000*

  Запрос:

  `select id, balance from users where email like '%test%' and balance > 1000`

  Результат:
        +--------+------------+
        | id     | balance    |
        +--------+------------+
        | 1      | 9999669.00 |
        | 20148  | 8377.00    |
        | 157509 | 5580.00    |
        | 157521 | 887676.00  |
        | 157532 | 10970.00   |
        | 157587 | 99709.00   |
        | 157752 | 10013.00   |
        | 157819 | 99200.00   |
        | 157821 | 1022.00    |
        | 157888 | 10000.00   |
        | 157892 | 2137.00    |
        | 157900 | 1710.00    |
        | 157921 | 99803.00   |
        +--------+------------+

3. Задача:

  *Показать значение столбца utm_source с группировкой по количеству*

  Запрос:

  `select utm_source, count(*) from users group by utm_source`

  Результат:
        +--------------------------------------------+----------+
        | utm_source                                 | count(*) |
        +--------------------------------------------+----------+
        | <null>                                     | 4934     |
        | source77                                   | 1        |
        | src2                                       | 1        |
        | tg_office                                  | 1        |
        | test                                       | 3        |
        | 129                                        | 2        |
        | R                                          | 4        |
        | rsy_mb7                                    | 1        |
        | rsy_mb5                                    | 1        |
        | bhw                                        | 97       |
        | affbank                                    | 56       |
        | FBK                                        | 1        |
        | cparip                                     | 10       |
        +--------------------------------------------+----------+

4. Задача:

  *Сортировка результатов. По умолчанию сортирует по возрастанию. Для сортировки по убыванию необходимо добавить desc*

  Запрос:

  `select id, balance from users where balance > 100000 order by balance`

  Результат:
        +--------+---------------+
        | id     | balance       |
        +--------+---------------+
        | 3788   | 131100.00     |
        | 4666   | 216400.00     |
        | 3504   | 626450.00     |
        | 157521 | 887676.00     |
        | 1      | 9999669.00    |
        | 15753  | 3243234234.00 |
        +--------+---------------+

5. Задача:

  *Получить сумму значений в столбце num, для записей у которых столбец date=2021-04-01*

  Запрос:

  `select sum(num) from stat_account where date='2021-04-01'`

  Результат:
        +----------+
        | sum(num) |
        +----------+
        | 1702     |
        +----------+

6. Задача:

  *Вывести дубликаты записей (одинаковую сумму баланса) с группировкой по сумме и количеством одинаковых дубликатов*

  Запрос:

  `select balance, count(*) as count from users group by balance having count(*) > 1 order by count`

  Результат:
        +---------------+-------+
        | balance       | count |
        +---------------+-------+
        | 1000.00000000 | 2     |
        | 751.00000000  | 2     |
        | 8.00000000    | 4     |
        | 100.00000000  | 4     |
        | 500.00000000  | 5     |
        | 6.00000000    | 5     |
        | 7.00000000    | 6     |
        | 5.00000000    | 6     |
        | 97.00000000   | 6     |
        | 1.00000000    | 7     |
        | 997.00000000  | 12    |
        | 10.00000000   | 15    |
        | 2.00000000    | 23    |
        | 3.00000000    | 35    |
        +---------------+-------+
